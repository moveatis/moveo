<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core">


<h:body>
	<ui:composition template="/WEB-INF/template.xhtml">

		<ui:define name="pageTitle">#{msg.ana_title}</ui:define>

		<ui:define name="mainpage">
			<h:outputScript library="primefaces" name="jquery/jquery.js" />
			<h:outputScript library="js" name="feedbackanalysissummary.js" />
			<h:outputStylesheet library="css" name="feedbackanalysissummary.css" />
			<h:outputScript library="js" name="html2canvas.min.js" />
			<h:outputScript>
    		function chartExtenderHideTicks() {   
this.cfg.grid = {         
    background: 'transparent',
    drawGridlines: false,
    drawBorder: false,
    shadow: false
};
  this.cfg.axes.xaxis.showTicks=false;  
  this.cfg.axes.yaxis.showTicks=false;
  this.cfg.title.fontSize=1;
  this.cfg.axes.yaxis.rendererOptions={drawBaseline:false}; 
  this.cfg.axes.xaxis.rendererOptions={drawBaseline:true}; 
};

  function chartExtender() {   
  this.cfg.axes.xaxis.showTicks=false;  
  this.cfg.axes.xaxis.rendererOptions={drawBaseline:true}; 
  this.cfg.title.fontSize=1;
    this.cfg.grid = {         
        background: 'transparent',
    drawGridlines: false,
    drawBorder: false,
    shadow: false
};}
			</h:outputScript>
			<h1>#{msg.ana_title} :
				#{feedbackAnalysisSummaryManagedBean.feedbackAnalyzation.name}</h1>
			<div id="container">
				<div id="tableImage">
					<table class="summaryTable">
					<ui:repeat
						value="#{feedbackAnalysisSummaryManagedBean.tableInformations}"
						var="tableInformation">
						<tr>
							<td>
								<table class="summaryTable">
									<tr>
										<th>#{tableInformation.feedbackAnalysisCategorySet}</th>
										<th>Osuus</th>
									</tr>
									<ui:repeat var="cat" value="#{tableInformation.categories}"
										varStatus="stat">
										<tr>
											<td style="width:30%">#{cat}</td>
											<td>#{tableInformation.counts.get(stat.index)}
												(#{feedbackAnalysisSummaryManagedBean.countPercentage(tableInformation.counts.get(stat.index))}
												%)</td>
										</tr>
									</ui:repeat>
								</table>
							</td>
						</tr>
					</ui:repeat>

				</table>
			</div>
					
					
					<h:form id="charts">
						<p:selectBooleanCheckbox
							value="#{feedbackAnalysisSummaryManagedBean.renderBarChart}"
							id="barChart">Barchart
			<p:ajax update="charts" />
						</p:selectBooleanCheckbox>
						<p:selectBooleanCheckbox
							value="#{feedbackAnalysisSummaryManagedBean.renderPieChart}"
							id="pieChart">Piechart
			<p:ajax update="charts" />
						</p:selectBooleanCheckbox>
						<h:panelGroup
							rendered="#{feedbackAnalysisSummaryManagedBean.renderBarChart}"
							layout="block" id="barModels">
							<ui:repeat
								value="#{feedbackAnalysisSummaryManagedBean.barModels}"
								var="barModel" varStatus="myVarStatus">
								<span id="barchart"> <p:chart class="chart" type="bar"
										model="#{barModel}" style="margin-bottom: #{1.5*feedbackAnalysisSummaryManagedBean.countMaxCategories()}em"
										widgetVar="barchart#{myVarStatus.index}" />
								</span>
							</ui:repeat>
							<p:separator />
						</h:panelGroup>
						<br />
						<h:panelGroup
							rendered="#{feedbackAnalysisSummaryManagedBean.renderPieChart}"
							id="pieModels">
							<ui:repeat
								value="#{feedbackAnalysisSummaryManagedBean.pieModels}"
								var="pieModel" varStatus="myVarStatus">
								<span id="piechart"> <p:chart class="chart" type="pie"
										model="#{pieModel}" style="width:300px; height:300px; margin-bottom: #{1.5*feedbackAnalysisSummaryManagedBean.countMaxCategories()}em"
										widgetVar="piechart#{myVarStatus.index}" />
								</span>
							</ui:repeat>
							<p:separator />
						</h:panelGroup>
					</h:form>
					
					
					<div id="hiddenButtons">
						<h:form>
							<p:commandButton value="#{msg.dlg_saveAndSend}"
								rendered="#{sessionBean.identifiedUser}"
								styleClass="save-button"
								onclick="createImage(); PF('dlgSave').show();" process="@this">
								<p:ajax update=":saveForm" resetValues="true" />
							</p:commandButton>

							<p:commandButton value="#{msg.dlg_saveDialogHeader}"
								rendered="#{!sessionBean.identifiedUser}"
								styleClass="save-button"
								onclick="createImage(); PF('dlgSave').show();" process="@this">
								<p:ajax update=":saveForm" resetValues="true" />
							</p:commandButton>
						</h:form>
					</div>

					<p:dialog header="#{msg.dlg_saveDialogHeaderAnalyzation}"
						id="saveDialog" widgetVar="dlgSave" position="top"
						resizable="false" responsive="true" fitViewport="true"
						visible="#{facesContext.validationFailed}"
						styleClass="coloredDialog">
						<h:form id="saveForm" styleClass="dialog-form ui-fluid">
							<p:selectManyCheckbox id="basic"
								rendered="#{sessionBean.identifiedUser}" columns="1"
								required="true" requiredMessage="" layout="grid">
								<p:ajax update="input-email" />
								<f:selectItem itemLabel="#{msg.dlg_saveOption}" itemValue="save"
									itemDisabled="#{!sessionBean.identifiedUser}" />
								<f:selectItem itemLabel="#{msg.dlg_imageOption}"
									itemValue="image" itemDisabled="#{!sessionBean.identifiedUser}" />
								<f:selectItem itemLabel="#{msg.dlg_downloadOption}"
									itemValue="download" itemDisabled="#{!sessionBean.loggedIn}" />
								<f:selectItem itemLabel="#{msg.dlg_mailOption}" itemValue="mail"
									itemDisabled="#{!sessionBean.identifiedUser}" />
							</p:selectManyCheckbox>
							<p:selectManyCheckbox id="anonymityUserBoxes"
								rendered="#{!sessionBean.identifiedUser}" columns="1"
								required="true" requiredMessage="" layout="grid">
								<f:selectItem itemLabel="#{msg.dlg_downloadOption}"
									itemValue="download" itemDisabled="#{!sessionBean.loggedIn}" />
								<f:selectItem itemLabel="#{msg.dlg_imageOption}"
									itemValue="image" itemDisabled="#{!sessionBean.loggedIn}" />
							</p:selectManyCheckbox>
							<h:outputLabel for="input-name"
								value="#{msg.asum_analyzationName}">
								<h:outputText rendered="#{sessionBean.identifiedUser}"
									value=" (#{msg.dlg_defaultFileName})" />
							</h:outputLabel>
							<p:message for="input-name" />
							<p:inputText id="input-name" required="true"
								requiredMessage="#{msg.dlg_notEmpty}" value="asd"
								validator="#{validationBean.validateShortString}" />

							<h:outputLabel for="input-description"
								value="#{msg.asum_analyzationDescription}" />
							<p:message for="input-description" />
							<p:inputTextarea id="input-description" value="asd"
								validator="#{validationBean.validateLongString}" rows="3"
								cols="16" autoResize="true" />

							<h:outputLabel for="input-target"
								value="#{msg.asum_analyzationTarget}" />
							<p:message for="input-target" />
							<p:inputText id="input-target" value="asd"
								validator="#{validationBean.validateShortString}" />

							<p:outputPanel rendered="#{sessionBean.identifiedUser}">
								<h:outputLabel for="input-email" value="#{msg.dlg_giveEmail}" />
								<p:message for="input-email" />
								<p:inputText id="input-email" required="true"
									requiredMessage="#{msg.dlg_notEmpty}" value="asd">
									<f:validator validatorId="emailValidator" />
								</p:inputText>
							</p:outputPanel>
							<p:commandButton value="#{msg.dlg_save}" icon="ui-icon-check"
								onclick="save()" ajax="false" validateClient="true" action="#{feedbackAnalysisSummaryManagedBean.save}"/>
							<p:commandButton value="#{msg.dlg_cancel}" icon="ui-icon-close"
								onclick="PF('dlgSave').hide();" />
						</h:form>
					</p:dialog>

					<div id="hiddenFunctionality">
						<p:outputPanel id="barimages"></p:outputPanel>
						<p:outputPanel id="pieimages"></p:outputPanel>
						<div id="chartCountDiv">
							<h:outputText
								value="#{feedbackAnalysisSummaryManagedBean.pieModels.size()}"
								id="chartCount" style="display:block"/>
						</div>
						<h:outputText value="#{feedackAnalysisSummaryManagedBean.testCSV}" />
					</div>
					<p:growl id="growl" widgetVar="growlWdgt" severity="info"
						showDetail="true" sticky="true" escape="false" />

				</div>
		</ui:define>

	</ui:composition>
</h:body>
</html>