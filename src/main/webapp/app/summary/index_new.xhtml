<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
<h:body>
	<ui:composition template="/WEB-INF/template.xhtml">
		<ui:define name="pageTitle"></ui:define>
		<ui:define name="mainpage">
			<!-- 	<script type="text/javascript">
        function getCategorySets() {
            return [
                   <ui:repeat value="#{feedbackAnalysisManagedBean.feedbackAnalysisCategorySetsInUse}" var="categorySet">
                       {name: "#{categorySet.name}"}
                   </ui:repeat>
                   ];                        
               } 		
		</script>  -->

			<div id="content">
				<ui:debug hotkey="x" />
				<!-- <ui:repeat var="FeedbackAnalysisRecordEntity" value="feedbackAnalysisManagedBean.feedbackAnalysisEntity.getRecords()">
					<h:outputText value="#{FeedbackAnalysisRecordEntity.getSelectedCategories()}"></h:outputText>  -->
				<h:form id="table">
					<ui:repeat
						value="#{feedbackAnalysisManagedBean.feedbackAnalysisCategorySetsInUse.toArray()}"
						var="categorySet">
						<h:outputText value="#{categorySet.label}" />
						<br />
					</ui:repeat>
					<br />
					<ui:repeat
						value="#{feedbackAnalysisManagedBean.feedbackAnalysisEntity.getRecords()}"
						var="feedbackAnalysisRecordEntity">
						<ul>
							<ui:repeat
								value="#{feedbackAnalysisRecordEntity.getSelectedCategories()}"
								var="selectedCategory">
								<li value="#{selectedCategory.label.text}"><p:commandLink
										value="#{selectedCategory.label.text}"
										action="#{feedbackAnalysisManagedBean.setCurrentRecord(feedbackAnalysisRecordEntity)}"
										onclick="PF('dlgCategorySet').show()"
										styleClass="link-categoryset" update=":categorySetForm ">
										<f:actionListener
											binding="#{feedbackAnalysisManagedBean.setSelectedCategory(selectedCategory)}" />

									</p:commandLink></li>
							</ui:repeat>
						</ul>
						<br />
					</ui:repeat>

				</h:form>
				<div id="textArea">
					<p:inputTextarea value="Lyhyt analyysi annetusta palautteesta" />
				</div>
			</div>
			
			
			
			<p:dialog header="Valitse Kategoriat" widgetVar="dlgCategorySet"
				position="top" resizable="false" responsive="true" modal="true"
				fitViewport="true" class="coloredDialog">

				<h:form id="categorySetForm">
					<ui:repeat
						value="#{feedbackAnalysisManagedBean.selectedCategory.categorySet.categoryEntitys.values().toArray()}"
						var="category">
						<p:selectBooleanButton value="#{category.inRecord}"
							onLabel="#{category.label.text}"
							offLabel="#{category.label.text}">
                			<p:ajax update=":categorySetForm"/>
						</p:selectBooleanButton>

					</ui:repeat>
						<p:commandButton value="tallenna muutokset"
							action="#{feedbackAnalysisManagedBean.editRecord}"
							onclick="PF('dlgCategorySet').hide()"
							update=":table" />
				</h:form>
			</p:dialog>
		</ui:define>
	</ui:composition>



</h:body>
</html>