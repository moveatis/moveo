<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:p="http://primefaces.org/ui">
<h:body>
	<ui:composition template="/WEB-INF/template.xhtml">
		<ui:define name="pageTitle">#{msg.ana_title}</ui:define>
		<ui:define name="mainpage">
			<h:outputScript library="primefaces" name="jquery/jquery.js" />
			<h:outputScript library="js" name="analyzer.js" />
			<h:outputStylesheet library="css" name="analyzer.css" />
			<h:form id="timerControls">
			<div id="timer_div">
			<span id="timer_span">
				<h:outputText id="txt_count"
					value="#{feedbackAnalyzationManagedBean.getDurationAsString()}" />
					</span>
					<span id="pause_span">
								<p:selectBooleanButton value="#{feedbackAnalyzationManagedBean.isTimerStopped}"
									onLabel="#{msg.ana_continue_timer}" onIcon="fa fa-play"
									offLabel="#{msg.ana_pause_timer}" offIcon="fa fa-pause" />
				</span>
				<p:poll id="timer" interval="1"
					listener="#{feedbackAnalyzationManagedBean.increment}"
					update="txt_count" />
			</h:form>
			<h:form id="form">
				<div id="content">
					<div id="index">
						<h:panelGrid columns="5">
							<p:commandButton value=" " id="firstAnalyze"
								icon="fa fa-fw fa-fast-backward"
								action="#{feedbackAnalyzationManagedBean.setCurrentRecord(1)}"
								disabled="#{feedbackAnalyzationManagedBean.isNavigationDisabled(true)}"
								update=":form" />
							<p:commandButton value=" " id="previousAnalyze"
								action="#{feedbackAnalyzationManagedBean.setCurrentRecord(feedbackAnalyzationManagedBean.currentRecordNumber-1)}"
								disabled="#{feedbackAnalyzationManagedBean.isNavigationDisabled(true)}"
								update=":form" icon="fa fa-fw fa-arrow-left" />
						</span>
						<div id="pageNumber">
							<h:outputText
								value="#{feedbackAnalyzationManagedBean.currentRecordNumber}/#{feedbackAnalyzationManagedBean.feedbackAnalyzationEntity.records.size()}" />
						</div>
						<span class="arrows" id="toNext">

							<p:commandButton value=" " id="nextAnalyze" icon="fa fa-fw fa-arrow-right"
								action="#{feedbackAnalyzationManagedBean.setCurrentRecord(feedbackAnalyzationManagedBean.currentRecordNumber+1)}"
								disabled="#{feedbackAnalyzationManagedBean.isNavigationDisabled(false)}"
								update=":form" />
						</span>
						<span class="arrows" id="toLast">
							<p:commandButton value=" " id="lastAnalyze" icon="fa fa-fw fa-fast-forward"
								action="#{feedbackAnalyzationManagedBean.setCurrentRecord(feedbackAnalyzationManagedBean.feedbackAnalyzationEntity.records.size())}"
								disabled="#{feedbackAnalyzationManagedBean.isNavigationDisabled(false)}"
								update=":form" />
						</span>
					</div>
					<h:panelGroup id="categories">
						<ui:repeat
							value="#{feedbackAnalyzationManagedBean.feedbackAnalysisCategorySetsInUse.toArray()}"
							var="categorySet">
							<div id="categoryContent">
								<div id="texts">
									<h:outputText value="#{categorySet.label}" />
								</div>
								<div id="buttons">
									<ui:repeat
										value="#{categorySet.categoryEntitys.values().toArray()}"
										var="category">
										<p:selectBooleanButton value="#{category.inRecord}"
											onLabel="#{category.label.text}"
											offLabel="#{category.label.text}">
											<p:ajax
												listener="#{feedbackAnalyzationManagedBean.setTimeStamp()}"
												update=":form:timestamp :form:categories" />
										</p:selectBooleanButton>
									</ui:repeat>
								</div>
							</div>
						</ui:repeat>
						<div id="timestamp_div">
							<span id="timestamp_name">
								<h:outputText id="txt_timestamp" value="#{msg.ana_timestamp}" />

							</span>
							<span id="timestamp_span">
						<p:commandLink onclick="PF('dlgTimeSlider').show()"
							update=":timeSlider">
							<h:outputText id="timestamp"
								value="#{feedbackAnalyzationManagedBean.getLongAsTimeStamp(feedbackAnalyzationManagedBean.currentRecord.startTime)}" />
						</p:commandLink>
								</span>
								</div>



					</h:panelGroup>
				</div>
				<div id="basicContent">
					<div id="textArea">
						<p:inputTextarea id="currentRecordComment"
							value="#{feedbackAnalyzationManagedBean.currentRecord.comment}"
							pt:placeholder="Kirjaa palaute tähän.">
							<p:ajax event="blur" process="currentRecordComment" />
						</p:inputTextarea>
					</div>
					<div id="basicControls">
						<p:commandButton id="new" value="#{msg.ana_new}"
							action="#{feedbackAnalyzationManagedBean.addRecord()}"
							update=":form" />
						<p:commandButton id="empty" value="#{msg.ana_empty}"
							action="#{feedbackAnalyzationManagedBean.resetCurrentRecord()}"
							update=":form" />
						<p:commandButton id="continue" value="#{msg.ana_continue}"
							action="#{feedbackAnalyzationManagedBean.toRecordTable()}" />
					</div>

				</div>
			</h:form>
			<p:dialog widgetVar="dlgTimeSlider" position="top" resizable="false"
				responsive="true" modal="true" fitViewport="true"
				class="coloredDialog">
				<h:form id="timeSlider">
					<h:outputText id="timeOutput"
						value="#{feedbackAnalyzationManagedBean.getLongAsTimeStamp(feedbackAnalyzationManagedBean.currentRecord.startTime)}" />
					<h:inputHidden id="secondsInput"
						value="#{feedbackAnalyzationManagedBean.currentRecord.startTime}">
					</h:inputHidden>
					<p:slider for="secondsInput"
						minValue="#{feedbackAnalyzationManagedBean.getMinTimeStampForCurrentRecord()}"
						maxValue="#{feedbackAnalyzationManagedBean.getMaxTimeStampForCurrentRecord()}">
						<p:ajax event="slideEnd" update="timeOutput :form:timestamp"
							process="secondsInput" />
					</p:slider>
				</h:form>
			</p:dialog>
		</ui:define>

	</ui:composition>
</h:body>
</html>
