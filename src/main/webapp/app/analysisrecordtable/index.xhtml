<!--  
 * Copyright (c) 2016, Jarmo Juujärvi, Sami Kallio, Kai Korhonen, Juha Moisio, Ilari Paananen 
 * Copyright (c) 2019, Karoliina Lappalainen, Tuomas Moisio, Visa Nykänen, Petra Puumala 
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *     1. Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     2. Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *
 *     3. Neither the name of the copyright holder nor the names of its 
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
<h:body>
	<ui:composition template="/WEB-INF/template.xhtml">
		<ui:define name="pageTitle"></ui:define>
		<ui:define name="mainpage">
			<div id="content">
				<ui:debug hotkey="x" />
			</div>
			<p:dataTable id="entries" value="#{feedbackAnalyzationManagedBean.feedbackAnalyzationEntity.records}"
				var="record" rowIndexVar="rowID">
				<p:column headerText="#">
					#{rowID+1}
				</p:column>
				<c:forEach items="#{feedbackAnalyzationManagedBean.feedbackAnalysisCategorySetsInUse.toArray()}"
					var="categorySet">
					<p:column headerText="#{categorySet.label}">
						<p:commandLink
							value="#{analysisRecordTable.getSelectedCategorysName(record.getSelectedCategories(), categorySet)}"
							action="#{feedbackAnalyzationManagedBean.setCurrentRecord(record)}"
							onclick="PF('dlgCategorySet').show()" update=":categorySetForm "
							styleClass="link-categoryset">
							<f:actionListener
								binding="#{feedbackAnalyzationManagedBean.setSelectedCategory(analysisRecordTable.getSelectedCategory(record.getSelectedCategories(), categorySet))}" />
							<h:outputText
								value="#{analysisRecordTable.getSelectedCategorysName(record.getSelectedCategories(), categorySet)}" />
						</p:commandLink>
					</p:column>
				</c:forEach>
				<p:column headerText="Sanallinen Palaute">
					<h:outputText value="#{record.comment}" />
				</p:column>
				<p:column>
					<p:commandLink action="#{analysisRecordTable.deleteCurrentRecord(record)}"
						styleClass="link-categoryset" update="entries">
						<h:outputText value="Delete" />
					</p:commandLink>
				</p:column>
			</p:dataTable>
			<p:dialog header="Info" widgetVar="rowDialog" modal="true" showEffect="fade" hideEffect="fade"
				resizable="false">
				<p:outputPanel id="rowDetail">
					<p:panelGrid columns="2" rendered="#{not empty analysisRecordTable.selectedRow}"
						columnClasses="label,value">
						<h:outputText value="Kommentti:" />
						<h:outputText value="#{analysisRecordTable.selectedRow.comment}" />
					</p:panelGrid>
				</p:outputPanel>
			</p:dialog>
			<div id="textArea">
				<p:inputTextarea value="Lyhyt analyysi annetusta palautteesta" />
			</div>
			<p:commandButton value="Continue to Summary" action="#{feedbackAnalyzationManagedBean.toSummary()}" />
			<p:dialog header="Valitse Kategoriat" widgetVar="dlgCategorySet" position="top" resizable="false"
				responsive="true" modal="true" fitViewport="true" class="coloredDialog">
				<h:form id="categorySetForm">
					<ui:repeat
						value="#{feedbackAnalyzationManagedBean.selectedCategory.categorySet.categoryEntitys.values()}"
						var="category">
						<p:selectBooleanButton value="#{category.inRecord}" onLabel="#{category.label.text}"
							offLabel="#{category.label.text}">
							<p:ajax update=":categorySetForm" />
						</p:selectBooleanButton>
					</ui:repeat>
					<p:commandButton value="tallenna muutokset" action="#{feedbackAnalyzationManagedBean.editRecord}"
						onclick="PF('dlgCategorySet').hide()" update=":entries" />
				</h:form>
			</p:dialog>
		</ui:define>
	</ui:composition>
</h:body>
</html>